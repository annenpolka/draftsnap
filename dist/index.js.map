{"version":3,"sources":["../src/cli.ts","../src/core/git.ts","../src/core/repository.ts","../src/utils/gitdir.ts","../src/utils/fs.ts","../src/types/errors.ts","../src/utils/path.ts","../src/commands/diff.ts","../src/commands/ensure.ts","../src/utils/timeline.ts","../src/commands/log.ts","../src/commands/prompt.ts","../src/commands/prune.ts","../src/commands/restore.ts","../src/core/lock.ts","../src/commands/snap.ts","../src/commands/status.ts","../src/commands/timeline.ts","../src/utils/logger.ts","../src/utils/stdin.ts","../src/index.ts"],"sourcesContent":["import { createRequire } from 'node:module'\nimport type { CAC } from 'cac'\nimport cac from 'cac'\nimport { diffCommand } from './commands/diff.js'\nimport { ensureCommand } from './commands/ensure.js'\nimport { logCommand } from './commands/log.js'\nimport { promptCommand } from './commands/prompt.js'\nimport { pruneCommand } from './commands/prune.js'\nimport { restoreCommand } from './commands/restore.js'\nimport { snapCommand } from './commands/snap.js'\nimport { statusCommand } from './commands/status.js'\nimport { timelineCommand } from './commands/timeline.js'\nimport { DraftsnapError, ExitCode } from './types/errors.js'\nimport { createLogger } from './utils/logger.js'\nimport { readAllStdin } from './utils/stdin.js'\n\nconst require = createRequire(import.meta.url)\nconst packageJson = require('../package.json') as { version?: string }\n\nconst DEFAULT_HINT =\n  'draftsnap: run `draftsnap --help` for commands or `draftsnap prompt` for agent guidance.'\n\ninterface Context {\n  workTree: string\n  gitDir: string\n  scratchDir: string\n  json: boolean\n  quiet: boolean\n  debug: boolean\n  logger: ReturnType<typeof createLogger>\n}\n\nfunction toBoolean(value: unknown): boolean {\n  return value === true\n}\n\nfunction parseOptionalNumber(value: unknown): number | undefined {\n  if (typeof value === 'number') return value\n  if (typeof value === 'string') {\n    const parsed = Number.parseInt(value, 10)\n    if (Number.isFinite(parsed)) {\n      return parsed\n    }\n  }\n  return undefined\n}\n\nfunction buildContext(options: Record<string, unknown>): Context {\n  const scratchDir = typeof options.scratch === 'string' ? options.scratch : 'scratch'\n  const gitDir = typeof options.gitDir === 'string' ? options.gitDir : '.git-scratch'\n  const json = toBoolean(options.json)\n  const quiet = toBoolean(options.quiet)\n  const debug = toBoolean(options.debug)\n\n  return {\n    workTree: process.cwd(),\n    gitDir,\n    scratchDir,\n    json,\n    quiet,\n    debug,\n    logger: createLogger({ json, quiet, debug }),\n  }\n}\n\nfunction printJson(data: unknown): void {\n  process.stdout.write(`${JSON.stringify(data)}\\n`)\n}\n\nfunction printDefaultHintJson(json: boolean): void {\n  if (json) {\n    printJson({ status: 'ok', code: ExitCode.OK, message: DEFAULT_HINT })\n  } else {\n    console.log(DEFAULT_HINT)\n  }\n  process.exitCode = ExitCode.OK\n}\n\nasync function executeWithHandling(\n  cli: CAC,\n  commandOptions: Record<string, unknown>,\n  handler: (ctx: Context) => Promise<void>,\n): Promise<void> {\n  const globalOptions = cli.options ?? {}\n  const ctx = buildContext({ ...globalOptions, ...commandOptions })\n\n  try {\n    await handler(ctx)\n  } catch (error) {\n    if (error instanceof DraftsnapError) {\n      if (ctx.json) {\n        printJson({\n          status: error.code === ExitCode.NO_CHANGES ? 'ok' : 'error',\n          code: error.code,\n          message: error.message,\n        })\n      } else {\n        console.error(error.message)\n      }\n      process.exitCode = error.code\n    } else {\n      console.error(error)\n      process.exitCode = 1\n    }\n  }\n}\n\nexport async function run(argv: string[]): Promise<void> {\n  const cli = cac('draftsnap')\n  cli.option('--scratch <dir>', 'scratch directory', { default: 'scratch' })\n  cli.option('--git-dir <dir>', 'sidecar git directory', { default: '.git-scratch' })\n  cli.option('--json', 'output JSON')\n  cli.option('--quiet', 'suppress logs')\n  cli.option('--debug', 'enable debug logs')\n\n  cli.command('ensure', 'Initialize or verify the sidecar').action(async (options) => {\n    await executeWithHandling(cli, options, async (ctx) => {\n      const result = await ensureCommand(ctx)\n      if (ctx.json) {\n        printJson(result)\n      }\n    })\n  })\n\n  cli\n    .command('snap [path]', 'Capture a snapshot from a file or stdin')\n    .option('-m, --message <message>', 'Commit message')\n    .option('--all', 'Snapshot all pending changes')\n    .option('--stdin', 'Read content from stdin')\n    .option('--space <name>', 'Optional space prefix')\n    .action(async (path, options) => {\n      await executeWithHandling(cli, options, async (ctx) => {\n        const stdinRequested = toBoolean(options.stdin)\n        const stdinContent = stdinRequested ? await readAllStdin() : undefined\n        const result = await snapCommand({\n          ...ctx,\n          path: options.all ? undefined : path,\n          message: options.message,\n          all: toBoolean(options.all),\n          space: options.space,\n          stdinContent,\n        })\n        if (ctx.json) {\n          printJson(result)\n        }\n      })\n    })\n\n  cli\n    .command('log [path]', 'List snapshots with metadata')\n    .option('--timeline', 'Show timeline summary for a document')\n    .option('--since <n>', 'Number of commits to include')\n    .action(async (path, options) => {\n      await executeWithHandling(cli, options, async (ctx) => {\n        const result = await logCommand({\n          ...ctx,\n          path,\n          timeline: toBoolean(options.timeline),\n          since: parseOptionalNumber(options.since),\n        })\n        if (ctx.json) {\n          printJson(result)\n        }\n      })\n    })\n\n  cli\n    .command('timeline [path]', 'Browse snapshot history interactively')\n    .option('--raw', 'Force plain-text fallback mode')\n    .option('--json', 'Output JSON (also available as global option)')\n    .action(async (path, options) => {\n      await executeWithHandling(cli, options, async (ctx) => {\n        const json = ctx.json || toBoolean(options.json)\n        const result = await timelineCommand({\n          ...ctx,\n          json,\n          path,\n          raw: toBoolean(options.raw),\n        })\n        if (json) {\n          printJson(result)\n        }\n      })\n    })\n\n  cli\n    .command('diff [path]', 'Compare recent snapshots or the working tree')\n    .option('--current', 'Compare against working tree')\n    .option('--since <n>', 'Number of commits to include')\n    .action(async (path, options) => {\n      await executeWithHandling(cli, options, async (ctx) => {\n        const result = await diffCommand({\n          ...ctx,\n          path,\n          current: toBoolean(options.current),\n          since: parseOptionalNumber(options.since),\n        })\n        if (ctx.json) {\n          printJson(result)\n        }\n      })\n    })\n\n  cli.command('status', 'Report initialization and lock status').action(async (options) => {\n    await executeWithHandling(cli, options, async (ctx) => {\n      const result = await statusCommand(ctx)\n      if (ctx.json) {\n        printJson(result)\n      }\n    })\n  })\n\n  cli\n    .command('restore <revision> <path>', 'Restore a file from a prior snapshot')\n    .action(async (revision, path, options) => {\n      await executeWithHandling(cli, options, async (ctx) => {\n        const result = await restoreCommand({\n          ...ctx,\n          revision,\n          path,\n        })\n        if (ctx.json) {\n          printJson(result)\n        }\n      })\n    })\n\n  cli\n    .command('prune', 'Trim old snapshots, keeping the latest N commits')\n    .option('--keep <n>', 'Number of commits to keep', { default: '100' })\n    .action(async (options) => {\n      await executeWithHandling(cli, options, async (ctx) => {\n        const keep = parseOptionalNumber(options.keep) ?? 100\n        const result = await pruneCommand({\n          ...ctx,\n          keep,\n        })\n        if (ctx.json) {\n          printJson(result)\n        }\n      })\n    })\n\n  cli\n    .command('prompt', 'Display guidance for using draftsnap safely')\n    .option('--json', 'Output guidance as JSON')\n    .action(async (options) => {\n      const json = toBoolean(options.json)\n      const output = promptCommand(json)\n      if (json) {\n        printJson(output)\n      } else {\n        console.log(output)\n      }\n      process.exitCode = ExitCode.OK\n    })\n\n  cli.help()\n  cli.version(packageJson.version ?? '0.0.0')\n\n  if (argv.length === 0) {\n    printDefaultHintJson(false)\n    return\n  }\n\n  const parsed = cli.parse(['', '', ...argv])\n\n  if (\n    !cli.matchedCommandName &&\n    parsed.args.length === 0 &&\n    !parsed.options.help &&\n    !parsed.options.version\n  ) {\n    printDefaultHintJson(Boolean(parsed.options.json))\n  }\n}\n","import { execFile } from 'node:child_process'\nimport { promisify } from 'node:util'\n\nconst execFileAsync = promisify(execFile)\n\nexport interface GitClientOptions {\n  workTree: string\n  gitDir: string\n}\n\nexport interface GitExecOptions {\n  cwd?: string\n  trim?: boolean\n}\n\nexport interface GitExecResult {\n  stdout: string\n  stderr: string\n}\n\nexport class GitError extends Error {\n  readonly args: readonly string[]\n  readonly exitCode: number | null\n  readonly stdout: string\n  readonly stderr: string\n\n  constructor(args: readonly string[], exitCode: number | null, stdout: string, stderr: string) {\n    super(`git ${args.join(' ')} (exit code ${exitCode ?? 'unknown'})`)\n    this.name = 'GitError'\n    this.args = args\n    this.exitCode = exitCode\n    this.stdout = stdout\n    this.stderr = stderr\n  }\n}\n\nexport interface GitClient {\n  exec(args: readonly string[], options?: GitExecOptions): Promise<GitExecResult>\n}\n\nconst DEFAULT_MAX_BUFFER = 10 * 1024 * 1024\n\nfunction stripTrailingNewline(value: string): string {\n  if (value.endsWith('\\r\\n')) {\n    return value.slice(0, -2)\n  }\n  if (value.endsWith('\\n')) {\n    return value.slice(0, -1)\n  }\n  return value\n}\n\nexport function createGitClient({ workTree, gitDir }: GitClientOptions): GitClient {\n  return {\n    async exec(args, options = {}) {\n      const gitArgs = ['--git-dir', gitDir, '--work-tree', workTree, ...args]\n      try {\n        const { stdout, stderr } = await execFileAsync('git', gitArgs, {\n          encoding: 'utf8',\n          maxBuffer: DEFAULT_MAX_BUFFER,\n          cwd: options.cwd ?? workTree,\n          env: {\n            ...process.env,\n            GIT_DIR: gitDir,\n            GIT_WORK_TREE: workTree,\n          },\n        })\n\n        return {\n          stdout: (options.trim ?? true) ? stripTrailingNewline(stdout) : stdout,\n          stderr: (options.trim ?? true) ? stripTrailingNewline(stderr) : stderr,\n        }\n      } catch (error) {\n        if (error && typeof error === 'object' && 'stdout' in error && 'stderr' in error) {\n          const execError = error as NodeJS.ErrnoException & {\n            stdout: string\n            stderr: string\n            code: number | null\n          }\n          const trim = options.trim ?? true\n          const stdout = execError.stdout ?? ''\n          const stderr = execError.stderr ?? ''\n          throw new GitError(\n            args,\n            typeof execError.code === 'number' ? execError.code : null,\n            trim ? stripTrailingNewline(stdout) : stdout,\n            trim ? stripTrailingNewline(stderr) : stderr,\n          )\n        }\n        throw error\n      }\n    },\n  }\n}\n","import type { Dirent } from 'node:fs'\nimport { mkdir, readdir, readFile, stat, writeFile } from 'node:fs/promises'\nimport { join, relative } from 'node:path'\nimport { resolveMainGitDir } from '../utils/gitdir.js'\nimport { createGitClient } from './git.js'\n\ninterface EnsureSidecarOptions {\n  workTree: string\n  gitDir: string\n  scratchDir: string\n}\n\ninterface EnsureSidecarResult {\n  initialized: boolean\n  gitDir: string\n  scratchDir: string\n  files: string[]\n}\n\nasync function pathExists(path: string): Promise<boolean> {\n  try {\n    await stat(path)\n    return true\n  } catch (error) {\n    if (\n      error &&\n      typeof error === 'object' &&\n      'code' in error &&\n      (error as NodeJS.ErrnoException).code === 'ENOENT'\n    ) {\n      return false\n    }\n    throw error\n  }\n}\n\nasync function listFiles(root: string): Promise<string[]> {\n  const results: string[] = []\n\n  async function walk(current: string, prefix: string): Promise<void> {\n    let entries: Dirent[]\n    try {\n      entries = await readdir(current, { withFileTypes: true })\n    } catch (error) {\n      if (\n        error &&\n        typeof error === 'object' &&\n        'code' in error &&\n        (error as NodeJS.ErrnoException).code === 'ENOENT'\n      ) {\n        return\n      }\n      throw error\n    }\n\n    for (const entry of entries) {\n      const nextPath = join(current, entry.name)\n      const nextPrefix = prefix ? `${prefix}/${entry.name}` : entry.name\n      if (entry.isDirectory()) {\n        await walk(nextPath, nextPrefix)\n      } else {\n        results.push(nextPrefix.replace(/\\\\/g, '/'))\n      }\n    }\n  }\n\n  await walk(root, '')\n  return results.sort()\n}\n\ninterface EnsureExcludeOptions {\n  workTree: string\n  scratchDir: string\n  gitDir: string\n  mainGitDir: string | null\n}\n\nasync function ensureExclude(options: EnsureExcludeOptions): Promise<void> {\n  const { workTree, scratchDir, gitDir, mainGitDir } = options\n  if (!mainGitDir) {\n    return\n  }\n\n  const excludePath = join(mainGitDir, 'info', 'exclude')\n  const excludeDir = join(mainGitDir, 'info')\n  await mkdir(excludeDir, { recursive: true })\n\n  const gitDirRelative = relative(workTree, gitDir) || gitDir\n  const desired = new Set([\n    `${scratchDir}/`,\n    `${gitDirRelative}${gitDirRelative.endsWith('/') ? '' : '/'}`,\n  ])\n\n  let current = ''\n  if (await pathExists(excludePath)) {\n    current = await readFile(excludePath, 'utf8')\n    for (const line of current.split('\\n')) {\n      if (line.trim()) {\n        desired.delete(line.trim())\n      }\n    }\n  }\n\n  if (desired.size === 0) {\n    return\n  }\n\n  const append = `${Array.from(desired).join('\\n')}\\n`\n  await writeFile(excludePath, current + append)\n}\n\nasync function ensureSidecarExclude(gitDir: string, scratchDir: string): Promise<void> {\n  const excludeDir = join(gitDir, 'info')\n  const excludePath = join(excludeDir, 'exclude')\n  await mkdir(excludeDir, { recursive: true })\n\n  let current = ''\n  const existingLines = new Set<string>()\n  if (await pathExists(excludePath)) {\n    current = await readFile(excludePath, 'utf8')\n    for (const line of current.split('\\n')) {\n      if (line.trim()) {\n        existingLines.add(line.trim())\n      }\n    }\n  }\n\n  const desired = ['*', `!${scratchDir}/`, `!${scratchDir}/**`]\n  const missing = desired.filter((entry) => !existingLines.has(entry))\n  if (missing.length === 0) {\n    return\n  }\n\n  const needsNewline = current.length > 0 && !current.endsWith('\\n')\n  const suffix = `${missing.join('\\n')}\\n`\n  const content = needsNewline ? `${current}\\n${suffix}` : `${current}${suffix}`\n  await writeFile(excludePath, content)\n}\n\nexport async function ensureSidecar(options: EnsureSidecarOptions): Promise<EnsureSidecarResult> {\n  const { workTree, gitDir, scratchDir } = options\n  const git = createGitClient({ workTree, gitDir })\n\n  let initialized = false\n  if (!(await pathExists(join(gitDir, 'HEAD')))) {\n    await git.exec(['init', '--quiet'])\n    initialized = true\n  }\n\n  await mkdir(join(workTree, scratchDir), { recursive: true })\n  const mainGitDir = await resolveMainGitDir(workTree)\n  await ensureExclude({ workTree, scratchDir, gitDir, mainGitDir })\n  await ensureSidecarExclude(gitDir, scratchDir)\n\n  const filesRoot = join(workTree, scratchDir)\n  const files = await listFiles(filesRoot)\n  const prefixed = files.map((file) => `${scratchDir}/${file}`)\n\n  return {\n    initialized,\n    gitDir,\n    scratchDir,\n    files: prefixed,\n  }\n}\n","import { readFile, stat } from 'node:fs/promises'\nimport { isAbsolute, join, resolve } from 'node:path'\nimport { isErrno } from './fs.js'\n\nfunction parseGitdir(content: string): string | null {\n  for (const rawLine of content.split('\\n')) {\n    const line = rawLine.trim()\n    if (!line) {\n      continue\n    }\n    const lower = line.toLowerCase()\n    if (lower.startsWith('gitdir:')) {\n      return line.slice('gitdir:'.length).trim()\n    }\n  }\n  return null\n}\n\nexport async function resolveMainGitDir(workTree: string): Promise<string | null> {\n  const dotGit = join(workTree, '.git')\n\n  try {\n    const stats = await stat(dotGit)\n    if (stats.isDirectory()) {\n      return dotGit\n    }\n\n    if (stats.isFile()) {\n      const content = await readFile(dotGit, 'utf8')\n      const gitdir = parseGitdir(content)\n      if (!gitdir) {\n        throw new Error(`unable to parse gitdir from ${dotGit}`)\n      }\n      return isAbsolute(gitdir) ? gitdir : resolve(workTree, gitdir)\n    }\n\n    return null\n  } catch (error) {\n    if (isErrno(error, 'ENOENT')) {\n      return null\n    }\n    throw error\n  }\n}\n","export function isErrno(error: unknown, code: string): boolean {\n  return (\n    !!error &&\n    typeof error === 'object' &&\n    'code' in error &&\n    (error as NodeJS.ErrnoException).code === code\n  )\n}\n","export enum ExitCode {\n  OK = 0,\n  NO_CHANGES = 10,\n  NOT_INITIALIZED = 11,\n  LOCKED = 12,\n  PRECONDITION_FAILED = 13,\n  INVALID_ARGS = 14,\n}\n\nexport class DraftsnapError extends Error {\n  readonly code: ExitCode\n  readonly context?: Record<string, unknown>\n\n  constructor(message: string, code: ExitCode, context?: Record<string, unknown>) {\n    super(message)\n    this.name = 'DraftsnapError'\n    this.code = code\n    this.context = context\n  }\n}\n\nexport class LockError extends DraftsnapError {\n  constructor(message = 'another process holds the lock') {\n    super(message, ExitCode.LOCKED)\n    this.name = 'LockError'\n  }\n}\n\nexport class InvalidArgsError extends DraftsnapError {\n  constructor(message: string) {\n    super(message, ExitCode.INVALID_ARGS)\n    this.name = 'InvalidArgsError'\n  }\n}\n\nexport class NoChangesError extends DraftsnapError {\n  constructor(message = 'no changes to snapshot') {\n    super(message, ExitCode.NO_CHANGES)\n    this.name = 'NoChangesError'\n  }\n}\n\nexport class NotInitializedError extends DraftsnapError {\n  constructor(message = 'sidecar repository not initialized') {\n    super(message, ExitCode.NOT_INITIALIZED)\n    this.name = 'NotInitializedError'\n  }\n}\n","import { isAbsolute, posix, relative, resolve, sep } from 'node:path'\n\nfunction toPosixPath(value: string): string {\n  return value.split(sep).join(posix.sep)\n}\n\nexport function sanitizeTargetPath(\n  candidate: string,\n  workTree: string,\n  scratchDir: string,\n): string | null {\n  const workRoot = resolve(workTree)\n  const scratchRoot = resolve(workRoot, scratchDir)\n  const targetAbs = isAbsolute(candidate) ? resolve(candidate) : resolve(workRoot, candidate)\n\n  const rel = relative(scratchRoot, targetAbs)\n  if (!rel || rel.startsWith('..') || rel === '') {\n    return null\n  }\n\n  if (rel.split(sep).some((segment) => segment === '..' || segment === '')) {\n    return null\n  }\n\n  return toPosixPath(`${scratchDir}/${rel}`)\n}\n","import { createGitClient } from '../core/git.js'\nimport { ensureSidecar } from '../core/repository.js'\nimport { ExitCode, InvalidArgsError } from '../types/errors.js'\nimport type { Logger } from '../utils/logger.js'\nimport { sanitizeTargetPath } from '../utils/path.js'\n\ninterface DiffCommandOptions {\n  workTree: string\n  gitDir: string\n  scratchDir: string\n  json: boolean\n  logger: Logger\n  path?: string\n  current?: boolean\n  since?: number\n}\n\ninterface DiffEntry {\n  path: string\n  added: number\n  removed: number\n}\n\ntype DiffBasis =\n  | { type: 'none' }\n  | { type: 'current'; new: string; old: string }\n  | { type: 'latest_pair'; new: string; old: string | null }\n  | { type: 'since'; since: number; new: string; old: string | null }\n\ninterface DiffCommandResult {\n  status: 'ok'\n  code: ExitCode\n  data: {\n    basis: DiffBasis\n    entries: DiffEntry[]\n    patch: string\n  }\n}\n\nfunction parseNumstat(output: string): DiffEntry[] {\n  if (!output.trim()) {\n    return []\n  }\n\n  return output\n    .split('\\n')\n    .map((line) => line.trim())\n    .filter(Boolean)\n    .map((line) => line.split('\\t'))\n    .filter((parts): parts is [string, string, string] => parts.length === 3)\n    .map(([addedRaw, removedRaw, file]) => {\n      const added = addedRaw === '-' ? 0 : Number.parseInt(addedRaw, 10)\n      const removed = removedRaw === '-' ? 0 : Number.parseInt(removedRaw, 10)\n      return {\n        path: file,\n        added: Number.isNaN(added) ? 0 : added,\n        removed: Number.isNaN(removed) ? 0 : removed,\n      }\n    })\n}\n\nexport async function diffCommand(options: DiffCommandOptions): Promise<DiffCommandResult> {\n  const { workTree, gitDir, scratchDir, json, logger, path, current, since } = options\n\n  await ensureSidecar({ workTree, gitDir, scratchDir })\n  const git = createGitClient({ workTree, gitDir })\n\n  let sanitizedPath: string | undefined\n  if (path) {\n    const candidate = sanitizeTargetPath(path, workTree, scratchDir)\n    if (!candidate) {\n      throw new InvalidArgsError('path must be within scratch directory')\n    }\n    sanitizedPath = candidate\n  }\n\n  const head = await git.exec(['rev-parse', '--verify', 'HEAD']).catch(() => null)\n  if (!head) {\n    return {\n      status: 'ok',\n      code: ExitCode.OK,\n      data: {\n        basis: { type: 'none' },\n        entries: [],\n        patch: '',\n      },\n    }\n  }\n\n  const pathArgs = sanitizedPath ? ['--', sanitizedPath] : []\n\n  if (current) {\n    const patchArgs = ['diff', 'HEAD', ...pathArgs]\n    const numstatArgs = ['diff', '--numstat', 'HEAD', ...pathArgs]\n    const patchResult = await git.exec(patchArgs)\n    const numstatResult = await git.exec(numstatArgs)\n    const entries = parseNumstat(numstatResult.stdout)\n\n    if (!json) {\n      if (patchResult.stdout) {\n        logger.info(patchResult.stdout)\n      } else if (entries.length > 0) {\n        entries.forEach((entry) => {\n          logger.info(`${entry.path} +${entry.added} -${entry.removed}`)\n        })\n      } else {\n        logger.info('no differences')\n      }\n    }\n\n    return {\n      status: 'ok',\n      code: ExitCode.OK,\n      data: {\n        basis: { type: 'current', new: 'working', old: head.stdout },\n        entries,\n        patch: patchResult.stdout,\n      },\n    }\n  }\n\n  if (since !== undefined && (!Number.isInteger(since) || since < 1)) {\n    throw new InvalidArgsError('--since must be >= 1')\n  }\n\n  if (since === undefined) {\n    const parent = await git.exec(['rev-parse', 'HEAD^']).catch(() => null)\n    if (!parent) {\n      if (!json) {\n        logger.info('no previous commit to diff against')\n      }\n      return {\n        status: 'ok',\n        code: ExitCode.OK,\n        data: {\n          basis: { type: 'latest_pair', new: head.stdout, old: null },\n          entries: [],\n          patch: '',\n        },\n      }\n    }\n\n    const patchArgs = ['diff', parent.stdout, head.stdout, ...pathArgs]\n    const numstatArgs = ['diff', '--numstat', parent.stdout, head.stdout, ...pathArgs]\n    const patchResult = await git.exec(patchArgs)\n    const numstatResult = await git.exec(numstatArgs)\n    const entries = parseNumstat(numstatResult.stdout)\n\n    if (!json) {\n      if (patchResult.stdout) {\n        logger.info(patchResult.stdout)\n      } else if (entries.length > 0) {\n        entries.forEach((entry) => {\n          logger.info(`${entry.path} +${entry.added} -${entry.removed}`)\n        })\n      } else {\n        logger.info('no differences')\n      }\n    }\n\n    return {\n      status: 'ok',\n      code: ExitCode.OK,\n      data: {\n        basis: { type: 'latest_pair', new: head.stdout, old: parent.stdout },\n        entries,\n        patch: patchResult.stdout,\n      },\n    }\n  }\n\n  const offset = since\n  const baseRef = await git.exec(['rev-parse', `HEAD~${offset}`]).catch(() => null)\n  if (!baseRef) {\n    return {\n      status: 'ok',\n      code: ExitCode.OK,\n      data: {\n        basis: { type: 'since', since: offset, new: head.stdout, old: null },\n        entries: [],\n        patch: '',\n      },\n    }\n  }\n\n  const patchArgs = ['diff', baseRef.stdout, head.stdout, ...pathArgs]\n  const numstatArgs = ['diff', '--numstat', baseRef.stdout, head.stdout, ...pathArgs]\n  const patchResult = await git.exec(patchArgs)\n  const numstatResult = await git.exec(numstatArgs)\n  const entries = parseNumstat(numstatResult.stdout)\n\n  if (!json) {\n    if (patchResult.stdout) {\n      logger.info(patchResult.stdout)\n    } else if (entries.length > 0) {\n      entries.forEach((entry) => {\n        logger.info(`${entry.path} +${entry.added} -${entry.removed}`)\n      })\n    } else {\n      logger.info('no differences')\n    }\n  }\n\n  return {\n    status: 'ok',\n    code: ExitCode.OK,\n    data: {\n      basis: { type: 'since', since: offset, new: head.stdout, old: baseRef.stdout },\n      entries,\n      patch: patchResult.stdout,\n    },\n  }\n}\n","import { ensureSidecar } from '../core/repository.js'\nimport { ExitCode } from '../types/errors.js'\nimport type { Logger } from '../utils/logger.js'\n\ninterface EnsureCommandOptions {\n  workTree: string\n  gitDir: string\n  scratchDir: string\n  json: boolean\n  logger: Logger\n}\n\ninterface EnsureCommandResult {\n  status: 'ok'\n  code: ExitCode\n  data: {\n    initialized: boolean\n    gitDir: string\n    scratchDir: string\n    files: string[]\n  }\n}\n\nexport async function ensureCommand(options: EnsureCommandOptions): Promise<EnsureCommandResult> {\n  const { workTree, gitDir, scratchDir, json, logger } = options\n  const result = await ensureSidecar({ workTree, gitDir, scratchDir })\n\n  if (!json) {\n    if (result.initialized) {\n      logger.info(`initialized sidecar at ${gitDir}`)\n    } else {\n      logger.info('sidecar already initialized')\n    }\n    if (result.files.length > 0) {\n      logger.info(`tracked files:\\n${result.files.join('\\n')}`)\n    }\n  }\n\n  return {\n    status: 'ok',\n    code: ExitCode.OK,\n    data: {\n      initialized: result.initialized,\n      gitDir: result.gitDir,\n      scratchDir: result.scratchDir,\n      files: result.files,\n    },\n  }\n}\n","export interface TimelineEntryHighlight {\n  type: 'add' | 'del' | 'context'\n  text: string\n}\n\nexport interface TimelineEntry {\n  commit: string\n  timestamp: string\n  message: string\n  additions: number\n  deletions: number\n  emoji?: string\n  highlights: TimelineEntryHighlight[]\n  section?: string\n}\n\nexport interface TimelineSummary {\n  commits: number\n  totalAdditions: number\n  totalDeletions: number\n  net: number\n}\n\nexport interface TimelineBarOptions {\n  scale: number\n  maxCommits: number\n}\n\nexport interface TimelineBar {\n  scale: number\n  filled: number\n}\n\nexport function computeTimelineBar(commits: number, options: TimelineBarOptions): TimelineBar {\n  const scale = Math.max(1, options.scale)\n  const maxCommits = Math.max(1, options.maxCommits)\n  const ratio = Math.min(1, commits / maxCommits)\n  const filled = Math.round(ratio * scale)\n  return {\n    scale,\n    filled: Math.min(scale, Math.max(0, filled)),\n  }\n}\n","import { createGitClient } from '../core/git.js'\nimport { ensureSidecar } from '../core/repository.js'\nimport { ExitCode, InvalidArgsError } from '../types/errors.js'\nimport type { Logger } from '../utils/logger.js'\nimport { sanitizeTargetPath } from '../utils/path.js'\nimport { computeTimelineBar, type TimelineEntry } from '../utils/timeline.js'\n\ninterface LogCommandOptions {\n  workTree: string\n  gitDir: string\n  scratchDir: string\n  json: boolean\n  logger: Logger\n  path?: string\n  timeline?: boolean\n  since?: number\n}\n\ninterface LogEntry {\n  commit: string\n  timestamp: string\n  message: string\n  path?: string\n}\n\ninterface LogCommandResult {\n  status: 'ok'\n  code: ExitCode\n  data: {\n    entries: LogEntry[]\n    timeline?: {\n      summary: {\n        commits: number\n        totalAdditions: number\n        totalDeletions: number\n        net: number\n      }\n      bars: {\n        scale: number\n        filled: number\n      }\n      entries: TimelineEntry[]\n      path: string\n    }\n  }\n}\n\nfunction parsePrettyLog(output: string, fallbackPath?: string): LogEntry[] {\n  if (!output.trim()) {\n    return []\n  }\n  const lines = output.split('\\n')\n  const entries: LogEntry[] = []\n  let current: LogEntry | undefined\n  for (const raw of lines) {\n    const line = raw.trimEnd()\n    if (!line.trim()) {\n      current = undefined\n      continue\n    }\n    if (line.includes('\\u001f')) {\n      const [commit, timestamp, message] = line.split('\\u001f')\n      if (commit && timestamp) {\n        current = { commit, timestamp, message }\n        entries.push(current)\n      }\n      continue\n    }\n    if (current && current.path === undefined) {\n      current.path = line\n    }\n  }\n  if (!fallbackPath) {\n    return entries\n  }\n  return entries.map((entry) => {\n    if (entry.path !== undefined) {\n      return entry\n    }\n    return { ...entry, path: fallbackPath }\n  })\n}\n\nfunction parseNumstat(\n  output: string,\n  targetPath: string,\n): {\n  entries: TimelineEntry[]\n  summary: { commits: number; totalAdditions: number; totalDeletions: number; net: number }\n} {\n  if (!output.trim()) {\n    return {\n      entries: [],\n      summary: { commits: 0, totalAdditions: 0, totalDeletions: 0, net: 0 },\n    }\n  }\n\n  const lines = output.split('\\n')\n  const entries: TimelineEntry[] = []\n  let totalAdditions = 0\n  let totalDeletions = 0\n  let currentCommit: TimelineEntry | undefined\n\n  for (const line of lines) {\n    if (!line.trim()) {\n      continue\n    }\n    if (line.startsWith('commit ')) {\n      const [, commit] = line.split(' ')\n      currentCommit = {\n        commit,\n        timestamp: '',\n        message: '',\n        additions: 0,\n        deletions: 0,\n        highlights: [],\n      }\n      entries.push(currentCommit)\n      continue\n    }\n    if (line.startsWith('date ')) {\n      if (currentCommit) {\n        currentCommit.timestamp = line.slice(5)\n      }\n      continue\n    }\n    if (line.startsWith('message ')) {\n      if (currentCommit) {\n        currentCommit.message = line.slice(8)\n      }\n      continue\n    }\n    const numstatMatch = line.match(/^(\\d+|-)\\t(\\d+|-)\\t(.+)$/)\n    if (numstatMatch && currentCommit) {\n      const [, addStr, delStr, file] = numstatMatch\n      if (file !== targetPath) {\n        continue\n      }\n      const additions = addStr === '-' ? 0 : Number(addStr)\n      const deletions = delStr === '-' ? 0 : Number(delStr)\n      currentCommit.additions += additions\n      currentCommit.deletions += deletions\n      totalAdditions += additions\n      totalDeletions += deletions\n      if (additions > 0) {\n        currentCommit.highlights.push({ type: 'add', text: `+${additions} lines` })\n      }\n      if (deletions > 0) {\n        currentCommit.highlights.push({ type: 'del', text: `-${deletions} lines` })\n      }\n    }\n  }\n\n  const filtered = entries\n    .filter((entry) => entry.additions > 0 || entry.deletions > 0 || entry.message)\n    .map((entry) => ({\n      ...entry,\n      highlights: entry.highlights.slice(0, 2),\n    }))\n\n  return {\n    entries: filtered,\n    summary: {\n      commits: filtered.length,\n      totalAdditions,\n      totalDeletions,\n      net: totalAdditions - totalDeletions,\n    },\n  }\n}\n\nexport async function logCommand(options: LogCommandOptions): Promise<LogCommandResult> {\n  const { workTree, gitDir, scratchDir, json, logger, path, timeline, since } = options\n\n  await ensureSidecar({ workTree, gitDir, scratchDir })\n  const git = createGitClient({ workTree, gitDir })\n\n  const head = await git.exec(['rev-parse', '--verify', 'HEAD']).catch(() => null)\n  if (!head) {\n    return {\n      status: 'ok',\n      code: ExitCode.OK,\n      data: { entries: [] },\n    }\n  }\n\n  let sanitizedPath: string | undefined\n  if (path) {\n    const candidate = sanitizeTargetPath(path, workTree, scratchDir)\n    if (!candidate) {\n      throw new InvalidArgsError('path must be within scratch directory')\n    }\n    sanitizedPath = candidate\n  }\n\n  if (timeline) {\n    if (!sanitizedPath) {\n      throw new InvalidArgsError('timeline mode requires -- <path>')\n    }\n    const args = [\n      'log',\n      '--follow',\n      '--date=iso-strict',\n      `--pretty=commit %H\\ndate %ad\\nmessage %s`,\n      '--numstat',\n    ]\n    if (since && since > 0) {\n      args.push(`-${since}`)\n    }\n    args.push('--', sanitizedPath)\n    const { stdout } = await git.exec(args)\n    const parsed = parseNumstat(stdout, sanitizedPath)\n    if (!json) {\n      if (parsed.entries.length === 0) {\n        logger.info(`no timeline entries for ${sanitizedPath}`)\n      } else {\n        logger.info(`timeline for ${sanitizedPath}`)\n        parsed.entries.forEach((entry) => {\n          logger.info(`${entry.timestamp} ${entry.message} +${entry.additions}/-${entry.deletions}`)\n        })\n      }\n    }\n    const bars = computeTimelineBar(parsed.entries.length, {\n      scale: 10,\n      maxCommits: Math.max(1, parsed.entries.length),\n    })\n    return {\n      status: 'ok',\n      code: ExitCode.OK,\n      data: {\n        entries: [],\n        timeline: {\n          summary: parsed.summary,\n          bars,\n          entries: parsed.entries,\n          path: sanitizedPath,\n        },\n      },\n    }\n  }\n\n  const format = '%H\\u001f%ad\\u001f%s'\n  const args = ['log', '--date=iso-strict', `--pretty=${format}`, '--name-only']\n  if (since && since > 0) {\n    args.push(`-${since}`)\n  }\n  if (sanitizedPath) {\n    args.push('--', sanitizedPath)\n  }\n  const { stdout } = await git.exec(args)\n  const entries = parsePrettyLog(stdout, sanitizedPath)\n\n  if (!json) {\n    if (entries.length === 0) {\n      logger.info('no log entries')\n    } else {\n      entries.forEach((entry) => {\n        logger.info(`${entry.commit.slice(0, 7)} ${entry.timestamp} ${entry.message}`)\n      })\n    }\n  }\n\n  return {\n    status: 'ok',\n    code: ExitCode.OK,\n    data: { entries },\n  }\n}\n","import { ExitCode } from '../types/errors.js'\n\nexport const PROMPT_TEXT = `You may use a CLI tool named \"draftsnap\" to manage temporary drafts (e.g., Markdown notes, outlines, experiments) in a sidecar Git repository. This tool provides a safety net when working with scratch files, allowing you to restore previous versions if needed.\n\nBasic workflow:\n1) Once per session, run \\`draftsnap ensure --json\\`. It idempotently prepares a local sidecar repo, creates the scratch directory, and sets \\`.git/info/exclude\\`. Proceed only if it returns JSON with code 0.\n\n2) When working with files in the configured scratch directory (default: \\`scratch/\\`), snapshot changes with:\n   \\`draftsnap snap <path> -m \"<short reason>\" --json\\`\n   \\`draftsnap snap --all -m \"<short reason>\" --json\\` to commit every modified scratch file together.\n   Treat exit code 0 as committed. Treat exit code 10 as \"no changes\" (still a success).\n\n3) Parse only STDOUT as JSON (\\`--json\\`). Never parse STDERR; it is human-oriented logs.\n\n4) To review or roll back, you may call:\n   - \\`draftsnap log --json [-- <path>]\\` to list history,\n   - \\`draftsnap diff [REV] --json [-- <path>]\\` to inspect changes,\n   - \\`draftsnap restore <REV> -- <path> --json\\` to restore content into the working tree.\n\n5) For periodic cleanup, you may run \\`draftsnap prune --keep 200 --json\\` (or \\`--days N\\`). Use it sparingly.\n\n6) Do not modify \\`.gitignore\\`; drafts are excluded locally via \\`.git/info/exclude\\`. The tool never pushes to any remote.\n\n7) If \\`draftsnap\\` is unavailable, continue your task without it; do not block.\n\nWhen to snapshot (default behavior):\n- After creating a new file in scratch/\n- After making substantial changes (structural changes, >10 lines modified, or significant content changes)\n- Before potentially destructive operations (e.g., large refactors, deletions)\n- When the user says \"try this\", \"experiment with\", or similar exploratory language\n\nDon't snapshot for:\n- Minor formatting changes (whitespace, indentation only)\n- Small typo fixes (<5 character changes)\n- When the user explicitly says \"don't snap\" or \"no need to snap\"\n\nUser can adjust frequency:\n- \"snap every edit\" → snapshot after every change, regardless of size\n- \"snap less\" or \"only snap when I say\" → only snapshot when explicitly requested\n- \"snap more often\" → be more aggressive with automatic snapshots\n\nMessage convention for \\`-m\\`:\nUse a terse \"purpose: summary\" style, e.g., \\`purpose: tighten outline\\`, \\`purpose: add authentication section\\`, so commits are searchable.\n\nReturn handling:\n- Success with commit: \\`{\"status\":\"ok\",\"code\":0,...}\\`\n- Success with no changes: \\`{\"status\":\"ok\",\"code\":10,...}\\`\n- Precondition or lock errors are non-fatal to your overall task; you may retry later.\n\nExamples:\n- Start: \\`draftsnap ensure --json\\`\n- After writing \\`scratch/idea.md\\`: \\`draftsnap snap scratch/idea.md -m \"purpose: initial draft\" --json\\`\n- After major edit to \\`scratch/design.md\\`: \\`draftsnap snap scratch/design.md -m \"purpose: add security considerations\" --json\\`\n- After touching multiple files: \\`draftsnap snap --all -m \"purpose: checkpoint session work\" --json\\`\n- Before a risky refactor: \\`draftsnap snap scratch/code.md -m \"purpose: pre-refactor checkpoint\" --json\\`\n\nThis tool provides safety when experimenting with AI-generated content. Use it proactively to enable fearless iteration.`\n\nexport function promptCommand(\n  json: boolean,\n): { status: 'ok'; code: ExitCode; message: string } | string {\n  if (json) {\n    return { status: 'ok', code: ExitCode.OK, message: PROMPT_TEXT }\n  }\n  return PROMPT_TEXT\n}\n","import { execFile } from 'node:child_process'\nimport { mkdtemp, rename, rm } from 'node:fs/promises'\nimport { tmpdir } from 'node:os'\nimport { join } from 'node:path'\nimport { promisify } from 'node:util'\nimport { createGitClient } from '../core/git.js'\nimport { ensureSidecar } from '../core/repository.js'\nimport { ExitCode, InvalidArgsError } from '../types/errors.js'\nimport type { Logger } from '../utils/logger.js'\n\nconst execFileAsync = promisify(execFile)\n\ninterface PruneCommandOptions {\n  workTree: string\n  gitDir: string\n  scratchDir: string\n  json: boolean\n  logger: Logger\n  keep: number\n}\n\ninterface PruneCommandResult {\n  status: 'ok'\n  code: ExitCode\n  data: {\n    kept: number\n    removed: number\n    removedCommits: string[]\n  }\n}\n\nexport async function pruneCommand(options: PruneCommandOptions): Promise<PruneCommandResult> {\n  const { workTree, gitDir, scratchDir, json, logger, keep } = options\n\n  if (!Number.isInteger(keep) || keep < 1) {\n    throw new InvalidArgsError('--keep must be >= 1')\n  }\n\n  await ensureSidecar({ workTree, gitDir, scratchDir })\n  const git = createGitClient({ workTree, gitDir })\n\n  const revList = await git.exec(['rev-list', '--reverse', 'HEAD']).catch(() => ({ stdout: '' }))\n  const commits = revList.stdout\n    .split('\\n')\n    .map((line) => line.trim())\n    .filter(Boolean)\n\n  if (commits.length === 0) {\n    return {\n      status: 'ok',\n      code: ExitCode.NO_CHANGES,\n      data: { kept: 0, removed: 0, removedCommits: [] },\n    }\n  }\n\n  if (commits.length <= keep) {\n    if (!json) {\n      logger.info('already within threshold')\n    }\n    return {\n      status: 'ok',\n      code: ExitCode.NO_CHANGES,\n      data: { kept: commits.length, removed: 0, removedCommits: [] },\n    }\n  }\n\n  const removeCount = commits.length - keep\n  const removedCommits = commits.slice(0, removeCount)\n\n  const tmpClone = await mkdtemp(join(tmpdir(), 'draftsnap-node-prune-'))\n\n  try {\n    await execFileAsync(\n      'git',\n      ['clone', '--quiet', '--depth', String(keep), '--no-checkout', gitDir, tmpClone],\n      {\n        cwd: workTree,\n        env: { ...process.env },\n      },\n    )\n\n    await rm(gitDir, { recursive: true, force: true })\n    await rename(join(tmpClone, '.git'), gitDir)\n\n    const refreshedGit = createGitClient({ workTree, gitDir })\n    await refreshedGit.exec(['reset', '--hard'])\n\n    if (!json) {\n      logger.info(`removed ${removeCount} commits, kept ${keep}`)\n    }\n\n    return {\n      status: 'ok',\n      code: ExitCode.OK,\n      data: {\n        kept: keep,\n        removed: removeCount,\n        removedCommits,\n      },\n    }\n  } finally {\n    await rm(tmpClone, { recursive: true, force: true })\n  }\n}\n","import { rename, stat, writeFile } from 'node:fs/promises'\nimport { join } from 'node:path'\nimport { createGitClient } from '../core/git.js'\nimport { LockManager } from '../core/lock.js'\nimport { ensureSidecar } from '../core/repository.js'\nimport { ExitCode, InvalidArgsError } from '../types/errors.js'\nimport type { Logger } from '../utils/logger.js'\nimport { sanitizeTargetPath } from '../utils/path.js'\n\ninterface RestoreCommandOptions {\n  workTree: string\n  gitDir: string\n  scratchDir: string\n  json: boolean\n  logger: Logger\n  revision: string\n  path: string\n}\n\ninterface RestoreCommandResult {\n  status: 'ok'\n  code: ExitCode\n  data: {\n    path: string\n    bytes: number\n    revision: string\n    backup?: string | null\n  }\n}\n\nexport async function restoreCommand(\n  options: RestoreCommandOptions,\n): Promise<RestoreCommandResult> {\n  const { workTree, gitDir, scratchDir, json, logger, revision, path } = options\n\n  const sanitized = sanitizeTargetPath(path, workTree, scratchDir)\n  if (!sanitized) {\n    throw new InvalidArgsError('path must be within scratch directory')\n  }\n\n  await ensureSidecar({ workTree, gitDir, scratchDir })\n  const git = createGitClient({ workTree, gitDir })\n  const lock = new LockManager(gitDir)\n  await lock.acquire()\n\n  try {\n    const blob = await git.exec(['show', `${revision}:${sanitized}`], { trim: false }).catch(() => {\n      throw new InvalidArgsError(`unknown revision or path: ${revision}`)\n    })\n\n    const absPath = join(workTree, sanitized)\n    let backup: string | null = null\n    const existing = await stat(absPath).catch(() => null)\n    if (existing) {\n      const backupPath = `${absPath}.draftsnap.bak.${Date.now()}`\n      await rename(absPath, backupPath)\n      backup = backupPath\n    }\n\n    await writeFile(absPath, blob.stdout)\n    const bytes = Buffer.byteLength(blob.stdout, 'utf8')\n\n    if (!json) {\n      logger.info(`restored ${sanitized} from ${revision}`)\n      if (backup) {\n        logger.info(`backup saved to ${backup}`)\n      }\n    }\n\n    return {\n      status: 'ok',\n      code: ExitCode.OK,\n      data: {\n        path: sanitized,\n        bytes,\n        revision,\n        backup,\n      },\n    }\n  } finally {\n    lock.release()\n  }\n}\n","import { existsSync, rmSync } from 'node:fs'\nimport { mkdir } from 'node:fs/promises'\nimport { dirname, join } from 'node:path'\nimport { LockError } from '../types/errors.js'\n\nexport interface AcquireOptions {\n  timeoutMs?: number\n  retryMs?: number\n}\n\nconst DEFAULT_TIMEOUT = 5_000\nconst DEFAULT_RETRY = 100\n\nfunction wait(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms))\n}\n\nexport class LockManager {\n  private readonly lockDir: string\n  private held = false\n  private cleanupRegistered = false\n\n  constructor(gitDir: string) {\n    this.lockDir = join(gitDir, '.draftsnap.lock')\n  }\n\n  async acquire(options: AcquireOptions = {}): Promise<void> {\n    if (this.held) {\n      return\n    }\n\n    const timeoutMs = options.timeoutMs ?? DEFAULT_TIMEOUT\n    const retryMs = options.retryMs ?? DEFAULT_RETRY\n    const deadline = Date.now() + timeoutMs\n    const parentDir = dirname(this.lockDir)\n\n    await mkdir(parentDir, { recursive: true })\n\n    while (true) {\n      try {\n        await mkdir(this.lockDir, { recursive: false })\n        this.held = true\n        this.registerCleanup()\n        return\n      } catch (error) {\n        if (\n          error &&\n          typeof error === 'object' &&\n          'code' in error &&\n          (error as NodeJS.ErrnoException).code === 'EEXIST'\n        ) {\n          if (Date.now() >= deadline) {\n            throw new LockError()\n          }\n\n          await wait(retryMs)\n          continue\n        }\n\n        throw error\n      }\n    }\n  }\n\n  release(): void {\n    if (!this.held) {\n      return\n    }\n\n    try {\n      if (existsSync(this.lockDir)) {\n        rmSync(this.lockDir, { recursive: true, force: true })\n      }\n    } finally {\n      this.held = false\n      this.cleanupRegistered = false\n    }\n  }\n\n  private registerCleanup(): void {\n    if (this.cleanupRegistered) {\n      return\n    }\n    const cleanup = () => {\n      this.release()\n    }\n    process.once('exit', cleanup)\n    process.once('SIGINT', () => {\n      cleanup()\n      process.exit(130)\n    })\n    process.once('SIGTERM', () => {\n      cleanup()\n      process.exit(143)\n    })\n    this.cleanupRegistered = true\n  }\n}\n","import { mkdir, stat, writeFile } from 'node:fs/promises'\nimport { dirname, isAbsolute, join, posix } from 'node:path'\nimport { createGitClient } from '../core/git.js'\nimport { LockManager } from '../core/lock.js'\nimport { ensureSidecar } from '../core/repository.js'\nimport { ExitCode, InvalidArgsError } from '../types/errors.js'\nimport { isErrno } from '../utils/fs.js'\nimport type { Logger } from '../utils/logger.js'\nimport { sanitizeTargetPath } from '../utils/path.js'\n\ninterface SnapCommandOptions {\n  workTree: string\n  gitDir: string\n  scratchDir: string\n  json: boolean\n  logger: Logger\n  path?: string\n  message?: string\n  space?: string\n  all?: boolean\n  stdinContent?: string\n}\n\ninterface SnapCommandResult {\n  status: 'ok'\n  code: ExitCode\n  data: {\n    commit: string | null\n    path: string | null\n    paths: string[]\n    files_count: number\n    bytes: number\n  }\n}\n\nasync function ensureFileExists(\n  _targetPath: string,\n  absPath: string,\n  stdinContent?: string,\n): Promise<void> {\n  await mkdir(dirname(absPath), { recursive: true })\n  if (stdinContent !== undefined) {\n    await writeFile(absPath, stdinContent)\n    return\n  }\n  try {\n    await stat(absPath)\n  } catch (error) {\n    if (\n      error &&\n      typeof error === 'object' &&\n      'code' in error &&\n      (error as NodeJS.ErrnoException).code === 'ENOENT'\n    ) {\n      await writeFile(absPath, '')\n      return\n    }\n    throw error\n  }\n}\n\nfunction normalizePath(value: string): string {\n  return value.replace(/\\\\/g, '/')\n}\n\nfunction resolveTargetPath(path: string, scratchDir: string, space?: string): string {\n  const normalized = normalizePath(path)\n\n  if (isAbsolute(path)) {\n    return path\n  }\n\n  const scratchPrefix = normalizePath(`${scratchDir}/`)\n  if (normalized === scratchDir || normalized.startsWith(scratchPrefix)) {\n    return normalized\n  }\n\n  if (space) {\n    return posix.join(scratchDir, space, normalized)\n  }\n\n  return posix.join(scratchDir, normalized)\n}\n\nexport async function snapCommand(options: SnapCommandOptions): Promise<SnapCommandResult> {\n  const { workTree, gitDir, scratchDir, json, logger, message, path, all, stdinContent, space } =\n    options\n\n  if (all && space) {\n    throw new InvalidArgsError('snap --all cannot be combined with --space')\n  }\n\n  const lock = new LockManager(gitDir)\n  await lock.acquire()\n\n  try {\n    await ensureSidecar({ workTree, gitDir, scratchDir })\n    const git = createGitClient({ workTree, gitDir })\n\n    let stagedPaths: string[] = []\n    let targetPath: string | null = null\n\n    if (all) {\n      await git.exec(['add', '-f', scratchDir])\n      const diff = await git.exec(['diff', '--cached', '--name-only'])\n      stagedPaths = diff.stdout\n        .split('\\n')\n        .map((line) => line.trim())\n        .filter(Boolean)\n      if (stagedPaths.length === 0) {\n        if (!json) {\n          logger.info(`no pending changes under ${scratchDir}`)\n        }\n        return {\n          status: 'ok',\n          code: ExitCode.NO_CHANGES,\n          data: { commit: null, path: null, paths: [], files_count: 0, bytes: 0 },\n        }\n      }\n    } else {\n      if (!path) {\n        throw new InvalidArgsError('snap requires a target path')\n      }\n      const candidate = resolveTargetPath(path, scratchDir, space)\n      const sanitized = sanitizeTargetPath(candidate, workTree, scratchDir)\n      if (!sanitized) {\n        throw new InvalidArgsError('path must be within scratch directory')\n      }\n      targetPath = sanitized\n      const absTarget = join(workTree, sanitized)\n      await ensureFileExists(sanitized, absTarget, stdinContent)\n      await git.exec(['add', '-f', '--', sanitized])\n      const diff = await git.exec(['diff', '--cached', '--name-only'])\n      stagedPaths = diff.stdout\n        .split('\\n')\n        .map((line) => line.trim())\n        .filter(Boolean)\n      stagedPaths = stagedPaths.filter((entry) => entry === sanitized)\n      if (stagedPaths.length === 0) {\n        if (!json) {\n          logger.info(`no changes for ${sanitized}`)\n        }\n        return {\n          status: 'ok',\n          code: ExitCode.NO_CHANGES,\n          data: { commit: null, path: sanitized, paths: [], files_count: 0, bytes: 0 },\n        }\n      }\n    }\n\n    let totalBytes = 0\n    for (const staged of stagedPaths) {\n      try {\n        const size = await stat(join(workTree, staged))\n        totalBytes += size.size\n      } catch (error) {\n        if (isErrno(error, 'ENOENT')) {\n          continue\n        }\n        throw error\n      }\n    }\n\n    const baseMessage = message ?? (all ? 'snap: all' : `snap: ${targetPath}`)\n    const finalMessage = !all && space ? `[space:${space}] ${baseMessage}` : baseMessage\n    await git.exec(['commit', '--quiet', '-m', finalMessage])\n    const commit = await git.exec(['rev-parse', 'HEAD'])\n\n    if (!json) {\n      if (all) {\n        logger.info(`snap stored ${stagedPaths.length} files at ${commit.stdout}`)\n      } else {\n        logger.info(`snap stored ${targetPath} at ${commit.stdout}`)\n      }\n    }\n\n    return {\n      status: 'ok',\n      code: ExitCode.OK,\n      data: {\n        commit: commit.stdout,\n        path: targetPath,\n        paths: stagedPaths,\n        files_count: stagedPaths.length,\n        bytes: totalBytes,\n      },\n    }\n  } finally {\n    lock.release()\n  }\n}\n","import { readFile, stat } from 'node:fs/promises'\nimport { join, relative } from 'node:path'\nimport { createGitClient } from '../core/git.js'\nimport { ExitCode } from '../types/errors.js'\nimport { isErrno } from '../utils/fs.js'\nimport { resolveMainGitDir } from '../utils/gitdir.js'\nimport type { Logger } from '../utils/logger.js'\n\ninterface StatusCommandOptions {\n  workTree: string\n  gitDir: string\n  scratchDir: string\n  json: boolean\n  logger: Logger\n}\n\ninterface StatusCommandResult {\n  status: 'ok'\n  code: ExitCode\n  data: {\n    initialized: boolean\n    locked: boolean\n    gitDir: string\n    scratchDir: string\n    exclude: {\n      main: {\n        gitDir: boolean\n        scrDir: boolean\n      }\n      sidecar: {\n        wildcard: boolean\n        scrDir: boolean\n        scrGlob: boolean\n      }\n    }\n    workingTree: {\n      hasUncommittedChanges: boolean\n      modified: string[]\n      added: string[]\n      deleted: string[]\n    }\n  }\n}\n\ninterface ParsedGitStatus {\n  hasChanges: boolean\n  modified: string[]\n  added: string[]\n  deleted: string[]\n}\n\n/**\n * Parse git status --porcelain output and categorize changes.\n *\n * Format: XY filepath\n * - X = staged status (first char)\n * - Y = unstaged status (second char)\n * - ?? = untracked file\n *\n * Status codes:\n * - M = modified\n * - A = added\n * - D = deleted\n * - R = renamed\n * - C = copied\n */\nexport function parseGitStatus(output: string): ParsedGitStatus {\n  const lines = output.split('\\n').filter(Boolean)\n  const modified = new Set<string>()\n  const added = new Set<string>()\n  const deleted = new Set<string>()\n\n  for (const line of lines) {\n    if (line.length < 3) continue\n\n    const statusCode = line.slice(0, 2)\n    const filePath = line.slice(3).trim()\n\n    // Skip directory entries (trailing slash indicates empty directory)\n    // Git reports untracked empty directories with trailing slash\n    if (filePath.endsWith('/')) {\n      continue\n    }\n\n    // Handle renamed files: \"R  old.md -> new.md\" or \"R  new.md\"\n    // Extract just the target filename\n    const actualFilePath = filePath.includes(' -> ') ? filePath.split(' -> ')[1].trim() : filePath\n\n    // Check staged status (first character)\n    const staged = statusCode[0]\n    // Check unstaged status (second character)\n    const unstaged = statusCode[1]\n\n    // Untracked files (shown as ??)\n    if (statusCode === '??') {\n      added.add(actualFilePath)\n      continue\n    }\n\n    // Modified: M in either position\n    if (staged === 'M' || unstaged === 'M') {\n      modified.add(actualFilePath)\n    }\n\n    // Added: A in staged position or C (copied)\n    if (staged === 'A' || staged === 'C') {\n      added.add(actualFilePath)\n    }\n\n    // Deleted: D in either position\n    if (staged === 'D' || unstaged === 'D') {\n      deleted.add(actualFilePath)\n    }\n\n    // Renamed: R in staged position (treat as modified)\n    if (staged === 'R') {\n      modified.add(actualFilePath)\n    }\n  }\n\n  return {\n    modified: Array.from(modified).sort(),\n    added: Array.from(added).sort(),\n    deleted: Array.from(deleted).sort(),\n    hasChanges: modified.size + added.size + deleted.size > 0,\n  }\n}\n\nasync function exists(path: string): Promise<boolean> {\n  try {\n    await stat(path)\n    return true\n  } catch (error) {\n    if (\n      error &&\n      typeof error === 'object' &&\n      'code' in error &&\n      (error as NodeJS.ErrnoException).code === 'ENOENT'\n    ) {\n      return false\n    }\n    throw error\n  }\n}\n\nexport async function statusCommand(options: StatusCommandOptions): Promise<StatusCommandResult> {\n  const { workTree, gitDir, scratchDir, json, logger } = options\n  const headExists = await exists(join(gitDir, 'HEAD'))\n  const lockExists = await exists(join(gitDir, '.draftsnap.lock'))\n\n  async function readExcludeLines(path: string): Promise<Set<string>> {\n    try {\n      const content = await readFile(path, 'utf8')\n      return new Set(\n        content\n          .split('\\n')\n          .map((line) => line.trim())\n          .filter(Boolean),\n      )\n    } catch (error) {\n      if (isErrno(error, 'ENOENT') || isErrno(error, 'ENOTDIR')) {\n        return new Set()\n      }\n      throw error\n    }\n  }\n\n  const mainGitDir = await resolveMainGitDir(workTree)\n  const mainExclude = mainGitDir\n    ? await readExcludeLines(join(mainGitDir, 'info', 'exclude'))\n    : new Set<string>()\n  const gitDirRelative = relative(workTree, gitDir) || gitDir\n  const mainGitDirEntry = mainExclude.has(\n    `${gitDirRelative}${gitDirRelative.endsWith('/') ? '' : '/'}`,\n  )\n  const mainScrDir = mainExclude.has(`${scratchDir}/`)\n\n  const sideExcludePath = join(gitDir, 'info', 'exclude')\n  const sideExclude = await readExcludeLines(sideExcludePath)\n  const sideWildcard = sideExclude.has('*')\n  const sideScrDir = sideExclude.has(`!${scratchDir}/`)\n  const sideScrGlob = sideExclude.has(`!${scratchDir}/**`)\n\n  // Get working tree status\n  let workingTreeStatus = {\n    hasUncommittedChanges: false,\n    modified: [] as string[],\n    added: [] as string[],\n    deleted: [] as string[],\n  }\n\n  if (headExists) {\n    try {\n      const git = createGitClient({ workTree, gitDir })\n      // Get status for all files\n      const { stdout } = await git.exec(['status', '--porcelain'])\n      const parsed = parseGitStatus(stdout)\n\n      // Filter to only include files within scratchDir\n      const scratchPrefix = `${scratchDir}/`\n      workingTreeStatus = {\n        hasUncommittedChanges: parsed.hasChanges,\n        modified: parsed.modified.filter((file) => file.startsWith(scratchPrefix)),\n        added: parsed.added.filter((file) => file.startsWith(scratchPrefix)),\n        deleted: parsed.deleted.filter((file) => file.startsWith(scratchPrefix)),\n      }\n\n      // Recalculate hasChanges based on filtered results\n      workingTreeStatus.hasUncommittedChanges =\n        workingTreeStatus.modified.length > 0 ||\n        workingTreeStatus.added.length > 0 ||\n        workingTreeStatus.deleted.length > 0\n    } catch (error) {\n      // git status failed - keep default values\n      // Log the error but don't fail the entire status command\n      if (!json) {\n        logger.warn(`failed to get working tree status: ${error}`)\n      }\n    }\n  }\n\n  if (!json) {\n    logger.info(`git dir: ${gitDir}`)\n    logger.info(`scratch dir: ${scratchDir}`)\n    logger.info(headExists ? 'initialized: yes' : 'initialized: no')\n    logger.info(lockExists ? 'locked: yes' : 'locked: no')\n    logger.info(\n      `main exclude - git_dir: ${mainGitDirEntry ? 'true' : 'false'}, scr_dir: ${mainScrDir ? 'true' : 'false'}`,\n    )\n    logger.info(\n      `sidecar exclude - wildcard: ${sideWildcard ? 'true' : 'false'}, scr_dir: ${sideScrDir ? 'true' : 'false'}, scr_glob: ${sideScrGlob ? 'true' : 'false'}`,\n    )\n    if (workingTreeStatus.hasUncommittedChanges) {\n      logger.info('uncommitted changes: yes')\n      logger.info(`  modified: ${workingTreeStatus.modified.length}`)\n      logger.info(`  added: ${workingTreeStatus.added.length}`)\n      logger.info(`  deleted: ${workingTreeStatus.deleted.length}`)\n    } else {\n      logger.info('uncommitted changes: no')\n    }\n  }\n\n  return {\n    status: 'ok',\n    code: ExitCode.OK,\n    data: {\n      initialized: headExists,\n      locked: lockExists,\n      gitDir,\n      scratchDir,\n      exclude: {\n        main: {\n          gitDir: mainGitDirEntry,\n          scrDir: mainScrDir,\n        },\n        sidecar: {\n          wildcard: sideWildcard,\n          scrDir: sideScrDir,\n          scrGlob: sideScrGlob,\n        },\n      },\n      workingTree: workingTreeStatus,\n    },\n  }\n}\n","import { execFile, spawn as spawnProcess } from 'node:child_process'\nimport { promisify } from 'node:util'\nimport { createGitClient } from '../core/git.js'\nimport { ensureSidecar } from '../core/repository.js'\nimport { ExitCode, InvalidArgsError, NotInitializedError } from '../types/errors.js'\nimport type { Logger } from '../utils/logger.js'\nimport { sanitizeTargetPath } from '../utils/path.js'\n\ninterface TimelineCommandOptions {\n  workTree: string\n  gitDir: string\n  scratchDir: string\n  json: boolean\n  raw: boolean\n  logger: Logger\n  path?: string\n  env?: {\n    stdoutIsTTY?: boolean\n    commandExists?: (command: string) => Promise<boolean>\n    spawn?: typeof spawnProcess\n    platform?: NodeJS.Platform\n  }\n}\n\ninterface TimelineEntry {\n  commit: string\n  relativeTime: string\n  authorDate: string\n  message: string\n  path: string\n}\n\ninterface TimelineModeContext {\n  json: boolean\n  raw: boolean\n  stdoutIsTTY: boolean\n  hasFzf: boolean\n}\n\nexport function decideTimelineMode(context: TimelineModeContext): 'json' | 'plain' | 'interactive' {\n  if (context.json) {\n    return 'json'\n  }\n  if (context.raw || !context.stdoutIsTTY) {\n    return 'plain'\n  }\n  if (context.hasFzf) {\n    return 'interactive'\n  }\n  return 'plain'\n}\n\ninterface TimelineCommandResult {\n  status: 'ok'\n  code: ExitCode\n  data: {\n    mode: 'json' | 'plain' | 'interactive'\n    entries: TimelineEntry[]\n  }\n}\n\nfunction parseLog(output: string, fallbackPath?: string): TimelineEntry[] {\n  if (!output.trim()) {\n    return []\n  }\n\n  const lines = output.split('\\n')\n  const entries: TimelineEntry[] = []\n  let current: Partial<TimelineEntry> | null = null\n  let inPathSection = false\n\n  const finalize = () => {\n    const commit = current?.commit\n    const relativeTime = current?.relativeTime\n    const authorDate = current?.authorDate\n    const message = current?.message\n    if (commit && relativeTime && authorDate && message) {\n      const path = current?.path ?? fallbackPath ?? ''\n      entries.push({ commit, relativeTime, authorDate, message, path })\n    }\n    current = null\n    inPathSection = false\n  }\n\n  for (const raw of lines) {\n    const line = raw.trimEnd()\n    if (!line) {\n      if (current) {\n        if (!inPathSection) {\n          inPathSection = true\n        } else {\n          finalize()\n        }\n      } else {\n        finalize()\n      }\n      continue\n    }\n    if (line.startsWith('commit ')) {\n      finalize()\n      current = { commit: line.slice(7).trim() }\n      inPathSection = false\n      continue\n    }\n    if (!current) {\n      continue\n    }\n    if (line.startsWith('relative ')) {\n      current.relativeTime = line.slice(9).trim()\n      continue\n    }\n    if (line.startsWith('author ')) {\n      current.authorDate = line.slice(7).trim()\n      continue\n    }\n    if (line.startsWith('message ')) {\n      current.message = line.slice(8)\n      continue\n    }\n    if (!current.path) {\n      current.path = line.trim()\n    }\n    inPathSection = true\n  }\n\n  finalize()\n\n  return entries\n}\n\nexport async function timelineCommand(\n  options: TimelineCommandOptions,\n): Promise<TimelineCommandResult> {\n  const { workTree, gitDir, scratchDir, json, raw, logger, path, env } = options\n\n  await ensureSidecar({ workTree, gitDir, scratchDir })\n  const git = createGitClient({ workTree, gitDir })\n\n  let sanitizedPath: string | undefined\n  if (path) {\n    const candidate = sanitizeTargetPath(path, workTree, scratchDir)\n    if (!candidate) {\n      throw new InvalidArgsError('path must be within scratch directory')\n    }\n    sanitizedPath = candidate\n  }\n\n  const stdoutIsTTY = env?.stdoutIsTTY ?? Boolean(process.stdout?.isTTY)\n  const platform = env?.platform ?? process.platform\n  let hasFzf = false\n  if (!json && !raw && stdoutIsTTY) {\n    const exists = env?.commandExists ?? commandExists\n    hasFzf = await exists('fzf')\n  }\n  const mode = decideTimelineMode({ json, raw, stdoutIsTTY, hasFzf })\n\n  const head = await git.exec(['rev-parse', '--verify', 'HEAD']).catch(() => null)\n  if (!head) {\n    if (mode === 'json') {\n      return {\n        status: 'ok',\n        code: ExitCode.OK,\n        data: { mode: 'json', entries: [] },\n      }\n    }\n    throw new NotInitializedError()\n  }\n\n  const args = [\n    'log',\n    '--date=iso-strict',\n    '--pretty=format:commit %H%nrelative %ar%nauthor %aI%nmessage %s',\n    '--name-only',\n  ]\n  if (sanitizedPath) {\n    args.push('--', sanitizedPath)\n  }\n\n  const { stdout } = await git.exec(args)\n  const entries = parseLog(stdout, sanitizedPath)\n\n  if (mode === 'plain') {\n    entries.forEach((entry) => {\n      logger.info(`${entry.relativeTime} │ ${entry.path} │ ${entry.message}`)\n    })\n    return {\n      status: 'ok',\n      code: ExitCode.OK,\n      data: { mode: 'plain', entries },\n    }\n  }\n\n  if (mode === 'json') {\n    return {\n      status: 'ok',\n      code: ExitCode.OK,\n      data: { mode: 'json', entries },\n    }\n  }\n\n  const spawnFn = env?.spawn ?? spawnProcess\n  const exists = env?.commandExists ?? commandExists\n  const code = await runInteractiveTimeline({\n    entries,\n    gitDir,\n    workTree,\n    spawn: spawnFn,\n    commandExists: exists,\n    platform,\n  })\n\n  return {\n    status: 'ok',\n    code,\n    data: { mode: 'interactive', entries },\n  }\n}\n\nconst execFileAsync = promisify(execFile)\n\nasync function commandExists(command: string): Promise<boolean> {\n  const checker = process.platform === 'win32' ? 'where' : 'which'\n  try {\n    await execFileAsync(checker, [command])\n    return true\n  } catch {\n    return false\n  }\n}\n\ninterface InteractiveParams {\n  entries: TimelineEntry[]\n  gitDir: string\n  workTree: string\n  spawn: typeof spawnProcess\n  commandExists: (command: string) => Promise<boolean>\n  platform: NodeJS.Platform\n}\n\nfunction shellQuote(value: string): string {\n  const escaped = value.replace(/([\"\\\\$`])/g, '\\\\$1')\n  return `\"${escaped}\"`\n}\n\nasync function runInteractiveTimeline(params: InteractiveParams): Promise<ExitCode> {\n  const { entries, gitDir, workTree, spawn, commandExists, platform } = params\n  if (entries.length === 0) {\n    return ExitCode.OK\n  }\n\n  const delimiter = String.fromCharCode(31)\n  const previewBase = `git --git-dir=${shellQuote(gitDir)} --work-tree=${shellQuote(workTree)} show {1}`\n  const useDelta = await commandExists('delta')\n  const previewCommand = useDelta ? `${previewBase} | delta` : previewBase\n  const pager = process.env.PAGER ?? 'less -R'\n  const diffPipeline = useDelta ? `${previewBase} | delta` : previewBase\n  const diffCommand = `sh -c ${shellQuote(`${diffPipeline} | ${pager}`)}`\n  const restoreCommand =\n    'sh -c ' +\n    shellQuote(\n      'read -r -p \"Restore {3}? [y/N] \" ans < /dev/tty && [ \"$ans\" = y ] && draftsnap restore {1} -- \"{3}\"',\n    )\n\n  const modifier = 'ctrl'\n  const modifierLabel = platform === 'darwin' ? 'Ctrl' : 'Ctrl'\n  const header = `Enter: view diff | ${modifierLabel}-R: restore | Esc: quit`\n\n  const args = [\n    '--ansi',\n    '--no-sort',\n    `--delimiter=${delimiter}`,\n    '--with-nth=5',\n    `--header=${header}`,\n    `--preview=${previewCommand}`,\n    '--preview-window=right:60%:wrap',\n    `--bind=enter:execute(${diffCommand})`,\n    `--bind=${modifier}-r:execute(${restoreCommand})+abort`,\n    '--bind=esc:abort',\n  ]\n\n  const child = spawn('fzf', args, { stdio: ['pipe', 'inherit', 'inherit'] })\n  entries.forEach((entry) => {\n    const display = `${entry.relativeTime} │ ${entry.path} │ ${entry.message}`\n    child.stdin.write(\n      `${entry.commit}${delimiter}${entry.relativeTime}${delimiter}${entry.path}${delimiter}${entry.message}${delimiter}${display}\\n`,\n    )\n  })\n  child.stdin.end()\n\n  await new Promise<void>((resolve) => {\n    child.on('close', (code) => {\n      if (typeof code === 'number') {\n        resolve()\n      } else {\n        resolve()\n      }\n    })\n  })\n\n  return ExitCode.OK\n}\n","export interface LoggerOptions {\n  json?: boolean\n  quiet?: boolean\n  debug?: boolean\n}\n\nexport interface Logger {\n  info(message: string): void\n  warn(message: string): void\n  error(message: string): void\n  debug(message: string): void\n}\n\nexport function createLogger(options: LoggerOptions, sink: Logger = defaultLogger): Logger {\n  const base = sink\n  return {\n    info(message: string) {\n      if (options.json || options.quiet) {\n        return\n      }\n      base.info(message)\n    },\n    warn(message: string) {\n      if (options.json || options.quiet) {\n        return\n      }\n      base.warn(message)\n    },\n    error(message: string) {\n      base.error(message)\n    },\n    debug(message: string) {\n      if (!options.debug || options.json) {\n        return\n      }\n      base.debug(message)\n    },\n  }\n}\n\nconst defaultLogger: Logger = {\n  info: (message) => console.error(message),\n  warn: (message) => console.error(message),\n  error: (message) => console.error(message),\n  debug: (message) => console.error(`[debug] ${message}`),\n}\n","export async function readAllStdin(): Promise<string> {\n  const chunks: string[] = []\n  return new Promise((resolve, reject) => {\n    process.stdin.setEncoding('utf8')\n    process.stdin.on('data', (chunk: string | Buffer) => {\n      chunks.push(typeof chunk === 'string' ? chunk : chunk.toString('utf8'))\n    })\n    process.stdin.on('error', reject)\n    process.stdin.on('end', () => resolve(chunks.join('')))\n  })\n}\n","#!/usr/bin/env node\nimport { run } from './cli.js'\n\nrun(process.argv.slice(2)).catch((error) => {\n  console.error(error)\n  process.exit(1)\n})\n"],"mappings":"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","names":["readFile","stat","join","stat","join","readFile","isAbsolute","relative","resolve","patchArgs","numstatArgs","patchResult","numstatResult","entries","parseNumstat","args","stdout","execFile","join","promisify","execFileAsync","promisify","execFile","join","rename","stat","writeFile","join","mkdir","join","resolve","join","mkdir","join","stat","rename","writeFile","mkdir","stat","writeFile","dirname","isAbsolute","join","posix","mkdir","dirname","writeFile","stat","isAbsolute","posix","join","readFile","stat","join","relative","stat","join","readFile","relative","execFile","promisify","exists","execFileAsync","promisify","execFile","commandExists","diffCommand","restoreCommand","resolve","resolve","require"]}